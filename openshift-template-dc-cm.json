{
    "kind": "Template",
    "apiVersion": "v1",
    "metadata": {
        "name": "sxapi-template",
        "annotations": {
            "openshift.io/display-name": "Startx SXAPI micro-service framework (latest)",
            "description": "SXAPI micro-service framework for running micro-service application running in a nodejs environement",
            "iconClass": "icon-nodejs",
            "tags": "builder,startx,alpine,nodejs,sxapi-latest",
            "openshift.io/long-description": "This template provides a startx sxapi micro-service framework container. Ready to use in openshift with a simple deployement config, or as a s2i builder for building web applications container. For more information about using this image, including OpenShift considerations, see https://github.com/startxfr/sxapi-core/blob/master/README.md.",
            "openshift.io/provider-display-name": "STARTX",
            "openshift.io/documentation-url": "https://github.com/startxfr/sxapi-core/blob/master/README.md",
            "openshift.io/support-url": "https://github.com/startxfr/sxapi-core/issues/new"
        }
    },
    "message": "The following container have been created in your project: ${APP_NAME} and you can use openshift console to log into.",
    "labels": {
        "template": "sxapi-template"
    },
    "objects": [
        {
            "kind": "ImageStream",
            "apiVersion": "v1",
            "metadata": {
                "name": "${APP_NAME}",
                "annotations": {
                    "openshift.io/display-name": "SXAPI ${APP_NAME}",
                    "openshift.io/generated-by": "STARTX"
                },
                "labels": {
                    "app": "${APP_NAME}",
                    "type": "${APP_TYPE}",
                    "provider": "startx",
                    "template": "sxapi-template"
                }
            },
            "spec": {
                "tags": [
                    {
                        "name": "latest",
                        "annotations": {
                            "openshift.io/display-name": "SXAPI ${APP_TYPE} ${APP_NAME}",
                            "description": "${APP_TYPE} ${APP_NAME} powered with sxapi microservice framework based on alpine (latest)",
                            "iconClass": "icon-nodejs",
                            "tags": "builder,startx,alpine,nodejs,sxapi-latest,${APP_NAME}",
                            "supports": "sxapi:latest,nodejs,http",
                            "version": "latest"
                        },
                        "from": {
                            "kind": "DockerImage",
                            "name": "startx/sxapi:latest"
                        }
                    }
                ]
            }
        },
        {
            "kind": "ConfigMap",
            "apiVersion": "v1",
            "metadata": {
                "name": "${APP_NAME}-config",
                "creationTimestamp": null,
                "labels": {
                    "app": "${APP_NAME}",
                    "type": "${APP_TYPE}",
                    "provider": "startx",
                    "template": "sxapi-template"
                },
                "annotations": {
                    "openshift.io/generated-by": "STARTX"
                }
            },
            "data": {
                "sxapi.json": "{\n    \"name\": \"sxapi-example\",\n    \"description\": \"sxapi example\",\n    \"version\": \"0.0.1\",\n    \"debug\": true,\n    \"resources\": {\n        \"serviceinfo-sample\": {\n            \"_class\": \"serviceinfo\"\n        }\n    },\n    \"log\": {\n        \"filters\": {\n            \"level\": \"0,1,2,3,4\",\n            \"type\": \"debug,info,error,warn\"\n        }\n    },\n    \"server\": {\n        \"port\": \"8080\",\n        \"endpoints\": [\n            {\n                \"path\": \"/\",\n                \"desc\": \"Display welcome message (HTML)\",\n                \"body\": \"\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eAPI Example\u003c/title\u003e\u003c/head\u003e\u003cbody\u003e\u003ch1\u003eThis is your API\u003c/h1\u003e\u003cp\u003eThis API is based on sxapi-core v0.1.10\u003c/p\u003e\u003c/body\u003e\u003c/html\u003e\"\n            },\n            {\n                \"path\": \"/health\",\n                \"resource\": \"serviceinfo-sample\",\n                \"endpoint\": \"health\"\n            },\n            {\n                \"path\": \"/info\",\n                \"resource\": \"serviceinfo-sample\",\n                \"endpoint\": \"info\"\n            },\n            {\n                \"path\": \"/ping\",\n                \"desc\": \"Ping the application. Return a sample message in json\",\n                \"code\": \"200\",\n                \"body\": \"pong\"\n            }\n        ]\n    }\n}\n"
            }
        },
        {
            "kind": "DeploymentConfig",
            "apiVersion": "v1",
            "metadata": {
                "name": "${APP_NAME}",
                "generation": 2,
                "creationTimestamp": null,
                "labels": {
                    "app": "${APP_NAME}",
                    "type": "${APP_TYPE}",
                    "provider": "startx",
                    "template": "sxapi-template"
                },
                "annotations": {
                    "openshift.io/generated-by": "STARTX"
                }
            },
            "spec": {
                "strategy": {
                    "type": "Rolling",
                    "rollingParams": {
                        "updatePeriodSeconds": 1,
                        "intervalSeconds": 1,
                        "timeoutSeconds": 60,
                        "maxUnavailable": "25%",
                        "maxSurge": "25%"
                    },
                    "resources": {}
                },
                "triggers": [
                    {
                        "type": "ImageChange",
                        "imageChangeParams": {
                            "automatic": true,
                            "containerNames": [
                                "${APP_NAME}"
                            ],
                            "from": {
                                "kind": "ImageStreamTag",
                                "name": "${APP_NAME}:latest"
                            }
                        }
                    },
                    {
                        "type": "ConfigChange"
                    }
                ],
                "replicas": 1,
                "test": false,
                "selector": {
                    "app": "${APP_NAME}",
                    "deploymentconfig": "${APP_NAME}"
                },
                "template": {
                    "metadata": {
                        "creationTimestamp": null,
                        "labels": {
                            "app": "${APP_NAME}",
                            "type": "${APP_TYPE}",
                            "provider": "startx",
                            "template": "sxapi-template",
                            "deploymentconfig": "${APP_NAME}"
                        },
                        "annotations": {
                            "openshift.io/generated-by": "STARTX"
                        }
                    },
                    "spec": {
                        "volumes": [
                            {
                                "name": "volume-${APP_NAME}-conf",
                                "configMap": {
                                    "name": "${APP_NAME}-config",
                                    "items": [
                                        {
                                            "key": "sxapi.json",
                                            "path": "sxapi.json"
                                        }
                                    ]
                                }
                            }
                        ],
                        "containers": [
                            {
                                "name": "sxapi",
                                "image": "startx/sxapi@sha256:ea6d24ac940397d417ac3767340f1ef7b97751e0b0593d13e0fcee16ddae68b8",
                                "command": [
                                    "npm",
                                    "start"
                                ],
                                "ports": [
                                    {
                                        "containerPort": 8080,
                                        "protocol": "TCP"
                                    }
                                ],
                                "resources": {},
                                "volumeMounts": [
                                    {
                                        "name": "volume-${APP_NAME}-conf",
                                        "mountPath": "/conf"
                                    }
                                ],
                                "livenessProbe": {
                                    "httpGet": {
                                        "path": "/health",
                                        "port": 8080,
                                        "scheme": "HTTP"
                                    },
                                    "initialDelaySeconds": 5,
                                    "timeoutSeconds": 2,
                                    "periodSeconds": 10,
                                    "successThreshold": 1,
                                    "failureThreshold": 3
                                },
                                "readinessProbe": {
                                    "httpGet": {
                                        "path": "/health",
                                        "port": 8080,
                                        "scheme": "HTTP"
                                    },
                                    "initialDelaySeconds": 2,
                                    "timeoutSeconds": 2,
                                    "periodSeconds": 10,
                                    "successThreshold": 1,
                                    "failureThreshold": 3
                                },
                                "terminationMessagePath": "/dev/termination-log",
                                "imagePullPolicy": "Always"
                            }
                        ],
                        "restartPolicy": "Always",
                        "terminationGracePeriodSeconds": 30,
                        "dnsPolicy": "ClusterFirst",
                        "securityContext": {}
                    }
                }
            },
            "status": {
                "observedGeneration": 2,
                "replicas": 1,
                "updatedReplicas": 1,
                "availableReplicas": 1
            }
        },
        {
            "kind": "Service",
            "apiVersion": "v1",
            "metadata": {
                "name": "${APP_NAME}",
                "creationTimestamp": null,
                "labels": {
                    "app": "${APP_NAME}",
                    "type": "${APP_TYPE}",
                    "provider": "startx",
                    "template": "sxapi-template"
                },
                "annotations": {
                    "openshift.io/generated-by": "STARTX"
                }
            },
            "spec": {
                "ports": [
                    {
                        "name": "8080-tcp",
                        "protocol": "TCP",
                        "port": 8080,
                        "targetPort": 8080
                    }
                ],
                "selector": {
                    "app": "${APP_NAME}",
                    "deploymentconfig": "${APP_NAME}"
                },
                "type": "ClusterIP",
                "sessionAffinity": "None"
            },
            "status": {
                "loadBalancer": {}
            }
        },
        {
            "kind": "Route",
            "apiVersion": "v1",
            "metadata": {
                "name": "${APP_NAME}",
                "creationTimestamp": null,
                "labels": {
                    "app": "${APP_NAME}",
                    "type": "${APP_TYPE}",
                    "provider": "startx",
                    "template": "sxapi-template"
                },
                "annotations": {
                    "openshift.io/generated-by": "STARTX"
                }
            },
            "spec": {
                "to": {
                    "kind": "Service",
                    "name": "${APP_NAME}",
                    "weight": 100
                },
                "port": {
                    "targetPort": "8080-tcp"
                }
            },
            "status": {
                "ingress": [
                    {
                        "routerName": "router",
                        "conditions": [
                            {
                                "type": "Admitted",
                                "status": "True"
                            }
                        ]
                    }
                ]
            }
        }
    ],
    "parameters": [
        {
            "name": "APP_NAME",
            "displayName": "Application name",
            "description": "The name of the created application",
            "value": "app",
            "required": true
        },
        {
            "name": "APP_TYPE",
            "displayName": "Application type",
            "description": "The type of the created application",
            "value": "application"
        }
    ]
}
